//>>built
define("dojo/_base/connect",["./kernel","../on","../topic","../aspect","./event","../mouse","./sniff","./lang","../keys"],function(i,g,j,p,t,m,e,h){function q(a,d,b,c,n){c=h.hitch(b,c);if(!a||!a.addEventListener&&!a.attachEvent)return p.after(a||i.global,d,c,!0);typeof d=="string"&&d.substring(0,2)=="on"&&(d=d.substring(2));if(!a)a=i.global;if(!n)switch(d){case "keypress":d=k;break;case "mouseenter":d=m.enter;break;case "mouseleave":d=m.leave}return g(a,d,c,n)}function o(a){a.keyChar=a.charCode?String.fromCharCode(a.charCode):
"";a.charOrCode=a.keyChar||a.keyCode}e.add("events-keypress-typed",function(){var a={charCode:0};try{a=document.createEvent("KeyboardEvent"),(a.initKeyboardEvent||a.initKeyEvent).call(a,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(d){}return a.charCode==0&&!e("opera")});var r={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},s=e("mac")?"metaKey":"ctrlKey",l=function(a,d){var b=h.mixin({},a,d);o(b);b.preventDefault=function(){a.preventDefault()};b.stopPropagation=
function(){a.stopPropagation()};return b},k;k=e("events-keypress-typed")?function(a,d){var b=g(a,"keydown",function(a){var b=a.keyCode,c=(b!=13||e("ie")>=9&&!e("quirks"))&&b!=32&&(b!=27||!e("ie"))&&(b<48||b>90)&&(b<96||b>111)&&(b<186||b>192)&&(b<219||b>222)&&b!=229;if(c||a.ctrlKey){c=c?0:b;if(a.ctrlKey)if(b==3||b==13)return d.call(a.currentTarget,a);else c>95&&c<106?c-=48:!a.shiftKey&&c>=65&&c<=90?c+=32:c=r[c]||c;b=l(a,{type:"keypress",faux:!0,charCode:c});d.call(a.currentTarget,b);if(e("ie"))try{a.keyCode=
b.keyCode}catch(f){}}}),c=g(a,"keypress",function(a){var b=a.charCode,a=l(a,{charCode:b>=32?b:0,faux:!0});return d.call(this,a)});return{remove:function(){b.remove();c.remove()}}}:e("opera")?function(a,d){return g(a,"keypress",function(a){var c=a.which;c==3&&(c=99);c=c<32&&!a.shiftKey?0:c;a.ctrlKey&&!a.shiftKey&&c>=65&&c<=90&&(c+=32);return d.call(this,l(a,{charCode:c}))})}:function(a,d){return g(a,"keypress",function(a){o(a);return d.call(this,a)})};var f={_keypress:k,connect:function(){var a=arguments,
d=[],b=0;d.push(typeof a[0]=="string"?null:a[b++],a[b++]);var c=a[b+1];d.push(typeof c=="string"||typeof c=="function"?a[b++]:null,a[b++]);for(c=a.length;b<c;b++)d.push(a[b]);return q.apply(this,d)},disconnect:function(a){a&&a.remove()},subscribe:function(a,d,b){return j.subscribe(a,h.hitch(d,b))},publish:function(a,d){return j.publish.apply(j,[a].concat(d))},connectPublisher:function(a,d,b){var c=function(){f.publish(a,arguments)};return b?f.connect(d,b,c):f.connect(d,c)},isCopyKey:function(a){return a[s]}};
f.unsubscribe=f.disconnect;h.mixin(i,f);return f});