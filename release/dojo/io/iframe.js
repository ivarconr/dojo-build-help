//>>built
define("dojo/io/iframe",["../_base/config","../_base/json","../_base/kernel","../_base/lang","../_base/xhr","../_base/sniff","../_base/window","../dom","../dom-construct","../query","require"],function(n,r,j,o,l,h,i,q,p,s,t){var e={create:function(a,c,b){if(window[a])return window[a];if(window.frames[a])return window.frames[a];b||(b=n.dojoBlankHtmlUrl||t.toUrl("../resources/blank.html"));c=p.place('<iframe id="'+a+'" name="'+a+'" src="'+b+'" onload="'+c+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',
i.body());return window[a]=c},setSrc:function(a,c,b){try{if(b){var d;(d=h("ie")||h("webkit")?a.contentWindow.document:a.contentWindow)?d.location.replace(c):a.location=c}else h("webkit")?a.location=c:frames[a.name].location=c}catch(k){}},doc:function(a){return a.contentDocument||a.name&&a.document&&i.doc.getElementsByTagName("iframe")[a.name].contentWindow&&i.doc.getElementsByTagName("iframe")[a.name].contentWindow.document||a.name&&i.doc.frames[a.name]&&i.doc.frames[a.name].document||null},send:function(a){if(!this._frame)this._frame=
this.create(this._iframeName,j._scopeName+".io.iframe._iframeOnload();");a=l._ioSetArgs(a,function(a){a.canceled=!0;a.ioArgs._callNext()},function(a){var b=null;try{var d=a.ioArgs,k=e.doc(e._frame),g=d.handleAs,b=k;if(g!="html")if(g=="xml"){if(h("ie")<9||h("ie")&&j.isQuirks){s("a",e._frame.contentWindow.document.documentElement).orphan();var f=e._frame.contentWindow.document.documentElement.innerText,f=f.replace(/>\s+</g,"><"),f=o.trim(f),b=l.contentHandlers.xml({responseText:f})}}else b=k.getElementsByTagName("textarea")[0].value,
g=="json"?b=r.fromJson(b):g=="javascript"&&(b=j.eval(b))}catch(u){b=u}finally{d._callNext()}return b},function(a,b){b.ioArgs._hasError=!0;b.ioArgs._callNext();return a});a.ioArgs._callNext=function(){if(!this._calledNext)this._calledNext=!0,e._currentDfd=null,e._fireNextRequest()};this._dfdQueue.push(a);this._fireNextRequest();l._ioWatch(a,function(a){return!a.ioArgs._hasError},function(a){return!!a.ioArgs._finished},function(a){a.ioArgs._finished?a.callback(a):a.errback(Error("Invalid dojo.io.iframe request state"))});
return a},_currentDfd:null,_dfdQueue:[],_iframeName:j._scopeName+"IoIframe",_fireNextRequest:function(){try{if(!(this._currentDfd||this._dfdQueue.length==0)){do var a=this._currentDfd=this._dfdQueue.shift();while(a&&a.canceled&&this._dfdQueue.length);if(!a||a.canceled)this._currentDfd=null;else{var c=a.ioArgs,b=c.args;c._contentToClean=[];var d=q.byId(b.form),k=b.content||{};if(d){if(k){var g=function(a,b){p.create("input",{type:"hidden",name:a,value:b},d);c._contentToClean.push(a)},f;for(f in k){var e=
k[f];if(o.isArray(e)&&e.length>1){var h;for(h=0;h<e.length;h++)g(f,e[h])}else d[f]?d[f].value=e:g(f,e)}}var i=d.getAttributeNode("action"),j=d.getAttributeNode("method"),m=d.getAttributeNode("target");if(b.url)c._originalAction=i?i.value:null,i?i.value=b.url:d.setAttribute("action",b.url);if(!j||!j.value)j?j.value=b.method?b.method:"post":d.setAttribute("method",b.method?b.method:"post");c._originalTarget=m?m.value:null;m?m.value=this._iframeName:d.setAttribute("target",this._iframeName);d.target=
this._iframeName;l._ioNotifyStart(a);d.submit()}else g=b.url+(b.url.indexOf("?")>-1?"&":"?")+c.query,l._ioNotifyStart(a),this.setSrc(this._frame,g,!0)}}}catch(n){a.errback(n)}},_iframeOnload:function(){var a=this._currentDfd;if(a){var a=a.ioArgs,c=q.byId(a.args.form);if(c){for(var b=a._contentToClean,d=0;d<b.length;d++)for(var e=b[d],g=0;g<c.childNodes.length;g++){var f=c.childNodes[g];if(f.name==e){p.destroy(f);break}}a._originalAction&&c.setAttribute("action",a._originalAction);if(a._originalTarget)c.setAttribute("target",
a._originalTarget),c.target=a._originalTarget}a._finished=!0}else this._fireNextRequest()}};o.setObject("dojo.io.iframe",e);return e});