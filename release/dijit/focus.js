//>>built
define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/ready","dojo/_base/sniff","dojo/Stateful","dojo/_base/unload","dojo/_base/window","dojo/window","./a11y","./registry","."],function(n,q,o,r,p,s,k,y,t,j,u,v,l,w,x,i,m){var g=new (q([u,s],{curNode:null,activeStack:[],constructor:function(){var a=k.hitch(this,function(a){o.isDescendant(this.curNode,a)&&this.set("curNode",null);o.isDescendant(this.prevNode,
a)&&this.set("prevNode",null)});n.before(p,"empty",a);n.before(p,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,d){var c=this,e=function(a){c._justMouseDowned=!0;setTimeout(function(){c._justMouseDowned=!1},0);if(!j("ie")||!a||!(a.srcElement&&a.srcElement.parentNode==null))c._onTouchNode(d||a.target||a.srcElement,"mouse")},b=j("ie")?a.document.documentElement:a.document;if(b)if(j("ie")){a.document.body.attachEvent("onmousedown",e);var f=
function(a){var b=a.srcElement.tagName.toLowerCase();b=="#document"||b=="body"||(x.isTabNavigable(a.srcElement)?c._onFocusNode(d||a.srcElement):c._onTouchNode(d||a.srcElement))};b.attachEvent("onactivate",f);var g=function(a){c._onBlurNode(d||a.srcElement)};b.attachEvent("ondeactivate",g);return{remove:function(){a.document.detachEvent("onmousedown",e);b.detachEvent("onactivate",f);b.detachEvent("ondeactivate",g);b=null}}}else{b.body.addEventListener("mousedown",e,!0);b.body.addEventListener("touchstart",
e,!0);var h=function(a){c._onFocusNode(d||a.target)};b.addEventListener("focus",h,!0);var i=function(a){c._onBlurNode(d||a.target)};b.addEventListener("blur",i,!0);return{remove:function(){b.body.removeEventListener("mousedown",e,!0);b.body.removeEventListener("touchstart",e,!0);b.removeEventListener("focus",h,!0);b.removeEventListener("blur",i,!0);b=null}}}},_onBlurNode:function(){this.set("prevNode",this.curNode);this.set("curNode",null);if(!this._justMouseDowned)this._clearActiveWidgetsTimer&&
clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(k.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([]);this.prevNode=null}),100)},_onTouchNode:function(a,d){this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var c=[];try{for(;a;){var e=r.get(a,"dijitPopupParent");if(e)a=i.byId(e).domNode;else if(a.tagName&&a.tagName.toLowerCase()=="body"){if(a===l.body())break;a=w.get(a.ownerDocument).frameElement}else{var b=
a.getAttribute&&a.getAttribute("widgetId"),f=b&&i.byId(b);f&&!(d=="mouse"&&f.get("disabled"))&&c.unshift(b);a=a.parentNode}}}catch(g){}this._setStack(c,d)},_onFocusNode:function(a){a&&a.nodeType!=9&&(this._onTouchNode(a),a!=this.curNode&&this.set("curNode",a))},_setStack:function(a,d){var c=this.activeStack;this.set("activeStack",a);for(var e=0;e<Math.min(c.length,a.length);e++)if(c[e]!=a[e])break;for(var b,f=c.length-1;f>=e;f--)if(b=i.byId(c[f]))b._hasBeenBlurred=!0,b.set("focused",!1),b._focusManager==
this&&b._onBlur(d),this.emit("widget-blur",b,d);for(f=e;f<a.length;f++)if(b=i.byId(a[f]))b.set("focused",!0),b._focusManager==this&&b._onFocus(d),this.emit("widget-focus",b,d)},focus:function(a){if(a)try{a.focus()}catch(d){}}}));t(function(){var a=g.registerWin(l.doc.parentWindow||l.doc.defaultView);j("ie")&&v.addOnWindowUnload(function(){a&&(a.remove(),a=null)})});m.focus=function(a){g.focus(a)};for(var h in g)/^_/.test(h)||(m.focus[h]=typeof g[h]=="function"?k.hitch(g,h):g[h]);g.watch(function(a,
d,c){m.focus[a]=c});return g});